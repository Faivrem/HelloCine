<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Hello Cine</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <link href="./stylesheets/mon_style.css" rel="stylesheet" />
</head>
<body>
<main id="app" class="container">
    <navigation-bar
        v-on:change-page="changePage($event)"
    ></navigation-bar>

    <index
            v-if="currentPage === 'index'" id="index">
    </index>

    <section v-if="currentPage === 'listeDesFilms'" id="search">
        <search-form></search-form>
    </section>


    <section v-if="currentPage === 'listeDesFilms'  || currentPage === 'index'" id="listeDesFilms">
        <film-item
                class="row"
                v-for="film in filmsList"
                v-bind:todo="film"
                v-bind:key="film.id">
        </film-item>
    </section>

    <section v-if="currentPage === 'connexion'" id="connexion">
        <connexion-form></connexion-form>
    </section>

    <section v-if="currentPage === 'inscription'" id="inscription">
        <inscription-form></inscription-form>
    </section>


    <footer>
        <footer-item></footer-item>
        <ajouter-film-form v-if="currentPage === 'listeDesFilms'"></ajouter-film-form>
    </footer>

</main>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.2/axios.js"></script>
<script src="component.js"></script>
<script>
    // Sans cette ligne + l'import de axios.js (2e <script>), this.$http ne fonctionnera pas
    Vue.prototype.$http = axios
    const app = new Vue({
        el: '#app',
        data: {
            currentPage: 'index',
            filter: '',
            menu: '',
            myList: [],
            name: 'Hello Cine',
            filmsList: [
                { id: 0, titre: 'Films1', description: 'Description1', annee: 'Année 1', image: './images/film-icon.png'},
                { id: 1, titre: 'Films2', description: 'Description2', annee: 'Année 2' , image: './images/film-icon.png'},
                { id: 2, titre: 'Films3', description: 'Description3', annee: 'Année 3', image: './images/film-icon.png'}
            ]
        },
        created () {
            // Ici, l'utilisation d'une fonction flêchée () => {} plutôt que function () {} est primordial !
            // sans fonction fléchée, this.myList = ... ne fonctionnera pas comme prévu
            this.$http.get('/list')
                .then(list => {
                    console.log('affichage de ma liste', list)
                    this.myList = list.data
                })
                .catch(err => {
                    console.log('error', err)
                })
        },
        methods: {
            sendNewElement () {
                this.$http.post('/list', {
                    name: this.name
                })
                    .then(() => {
                        this.myList.push({
                            name: this.name
                        })
                    })
            },
            // Pour discussion entre navigation-bar component et Vue
            changePage (page) {
                this.currentPage = page;
            }
        }
    })
</script>
</body>
</html>